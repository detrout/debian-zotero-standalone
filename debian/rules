#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

include /usr/share/dpkg/pkg-info.mk

%:
	dh $@ --with xul-ext

override_dh_auto_build:
	./build.sh -p l -v ${DEB_VERSION} -d

	# Create the XPI file, filtering out the test subdirectory
	cp -a modules/zotero modules/zotero.new
	rm -rf modules/zotero.new/test
	xpi-pack modules/zotero.new xul-ext-zotero.xpi
	rm -rf modules/zotero.new

override_dh_auto_install:
	rm -f staging/zotero-standalone/COPYING
	rm -f staging/zotero-standalone/xul-ext/zotero-standalone/COPYING
	rm -f staging/zotero-standalone/xul-ext/zotero-standalone/resource/tinymce/license.txt
	rm -f staging/zotero-libreoffice-integration/COPYING
	mkdir -p staging/Zotero_OpenOffice_Integration
	unzip staging/zotero-libreoffice-integration/install/Zotero_OpenOffice_Integration.oxt -d staging/Zotero_OpenOffice_Integration
	install-xpi -p xul-ext-zotero -r xul-ext-zotero.xpi

override_dh_auto_clean:
	rm -rf staging
	rm -f xul-ext-zotero.xpi
